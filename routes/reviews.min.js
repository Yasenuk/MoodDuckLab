// @ts-nocheck
const express=require("express"),router=express.Router(),pool=require("../db"),reviewLimiter=require("../middleware/limit");router.post("/send-review",reviewLimiter,(async(e,s)=>{const{rating:r=5,name:t,phone:o,message:a,pluses:n="",minuses:i="–ü–æ–∫–∏ –Ω–µ –±–∞—á—É"}=e.body,u=Math.floor(21*Math.random())+1;if(!(e=>/^[–ê-–Ø–∞-—èA-Za-z–á—ó–Ü—ñ–Ñ—î“ê“ë'‚Äô\-\s]{2,50}$/.test(e))(t))return s.status(400).json({success:!1,error:"–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–µ —ñ–º'—è –∞–±–æ –ø—Ä—ñ–∑–≤–∏—â–µ"});if(!(e=>/^\+380\d{9}$/.test(e))(o))return s.status(400).json({success:!1,error:"–ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É"});if(!((c=a)&&c.length>=5&&c.length<=500))return s.status(400).json({success:!1,error:"–í—ñ–¥–≥—É–∫ –∑–∞–Ω–∞–¥—Ç–æ –∫–æ—Ä–æ—Ç–∫–∏–π"});var c;try{await pool.query("INSERT INTO reviews (username, rating, avatar_id, review_text, pros, cons, phone)\n       VALUES ($1, $2, $3, $4, $5, $6, $7)",[t,r,u,a,n,i,o]),s.status(200).json({success:!0,message:"–í—ñ–¥–≥—É–∫ –∑–±–µ—Ä–µ–∂–µ–Ω–æ!"})}catch(e){console.error("üí• –ü–æ–º–∏–ª–∫–∞ –±–∞–∑–∏:",e.message),s.status(500).json({success:!1,error:"–ü–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞..."})}})),router.get("/reviews",(async(e,s)=>{try{const e=await pool.query("SELECT id, username, rating, avatar_id, review_text, pros, cons, phone, published_at\n       FROM reviews\n       ORDER BY published_at DESC");s.json(e.rows)}catch(e){console.error("–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ –≤—ñ–¥–≥—É–∫—ñ–≤:",e.message),s.status(500).json({error:"–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –≤—ñ–¥–≥—É–∫–∏..."})}})),module.exports=router;