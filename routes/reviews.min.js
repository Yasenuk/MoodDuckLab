// @ts-nocheck
const express=require("express"),router=express.Router(),pool=require("../db-connect"),reviewLimiter=require("../middleware/limit");router.post("/send-review",reviewLimiter,(async(e,s)=>{const{rating:r=5,name:t,phone:o,message:a,pluses:n="Поки не бачу",minuses:i="Поки не бачу"}=e.body,u=Math.floor(21*Math.random())+1;if(!(e=>/^[А-Яа-яA-Za-zЇїІіЄєҐґ'’\-\s]{2,50}$/.test(e))(t))return s.status(400).json({success:!1,error:"Некоректне ім'я або прізвище!"});if(!(e=>/^380\d{9}$/.test(e.replace(/\D/g,"")))(o))return s.status(400).json({success:!1,error:"Некоректний номер телефону!"});if(!((c=a)&&c.length>=5&&c.length<=500))return s.status(400).json({success:!1,error:"Відгук занадто короткий або превищив 500 символів!"});var c;try{await pool.query("INSERT INTO reviews (username, rating, avatar_id, review_text, pros, cons, phone)\n       VALUES ($1, $2, $3, $4, $5, $6, $7)",[t,r,u,a,n,i,o]),s.status(200).json({success:!0,message:"Відгук збережено!"})}catch(e){console.error("Помилка бази:",e.message),s.status(500).json({success:!1,error:"Помилка сервера..."})}})),router.get("/reviews",(async(e,s)=>{try{const e=await pool.query("SELECT id, username, rating, avatar_id, review_text, pros, cons, phone, published_at\n       FROM reviews\n       ORDER BY published_at DESC");s.json(e.rows)}catch(e){console.error("Помилка при отриманні відгуків:",e.message),s.status(500).json({error:"Не вдалося отримати відгуки..."})}})),module.exports=router;